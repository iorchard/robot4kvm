Create Rocky Linux 9 Cloud Image
==================================

This is a guide to create Rocky Linux 9 cloud image.

Download Rocky Linux 9.5 minimal iso.::

   $ mkdir /data/jijisa/images
   $ cd /data/jijisa/images
   $ curl -sLO https://dl.rockylinux.org/pub/rocky/9.5/isos/x86_64/Rocky-9.5-x86_64-minimal.iso

Create clex sha512 hash password using the following command::

   $ python3 -c 'import crypt,getpass;pw=getpass.getpass();print(crypt.crypt(pw) if (pw==getpass.getpass("Confirm: ")) else exit())'


Edit ks.cfg to put user password.::

   rootpw --lock
   user --name=clex --iscrypted --password <sha512_user_password>

Modify NET_BR in rocky_build.sh for your env.

Run rocky_build.sh.::

   $ bash rocky_build.sh

Run virt-sysprep for the VM domain.::

   $ virt-sysprep -d rocky9
   [   0.0] Examining the guest ...
   [   5.4] Performing "abrt-data" ...
   [   5.4] Performing "backup-files" ...
   [   6.1] Performing "bash-history" ...
   [   6.2] Performing "blkid-tab" ...
   [   6.2] Performing "crash-data" ...
   [   6.2] Performing "cron-spool" ...
   [   6.3] Performing "dhcp-client-state" ...
   [   6.3] Performing "dhcp-server-state" ...
   [   6.3] Performing "dovecot-data" ...
   [   6.3] Performing "logfiles" ...
   [   6.5] Performing "machine-id" ...
   [   6.5] Performing "mail-spool" ...
   [   6.5] Performing "net-hostname" ...
   [   6.6] Performing "net-hwaddr" ...
   [   6.8] Performing "pacct-log" ...
   [   6.8] Performing "package-manager-cache" ...
   [   6.8] Performing "pam-data" ...
   [   6.9] Performing "passwd-backups" ...
   [   6.9] Performing "puppet-data-log" ...
   [   6.9] Performing "rh-subscription-manager" ...
   [   6.9] Performing "rhn-systemid" ...
   [   7.0] Performing "rpm-db" ...
   [   7.0] Performing "samba-db-log" ...
   [   7.0] Performing "script" ...
   [   7.0] Performing "smolt-uuid" ...
   [   7.0] Performing "ssh-hostkeys" ...
   [   7.1] Performing "ssh-userdir" ...
   [   7.1] Performing "sssd-db-log" ...
   [   7.1] Performing "tmp-files" ...
   [   7.1] Performing "udev-persistent-net" ...
   [   7.2] Performing "utmp" ...
   [   7.2] Performing "yum-uuid" ...
   [   7.2] Performing "customize" ...
   [   7.2] Setting a random seed
   [   7.3] Setting the machine ID in /etc/machine-id
   [   7.3] Performing "lvm-uuids" ...

Trim the image.::

   $ cd /data/jijisa/images
   $ virt-sparsify \
     Rocky-9-GenericCloud-9.5-<timestamp>-x86_64.qcow2 \
     Rocky-9-GenericCloud-9.5-x86_64.qcow2

